<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Vendora | Checkout</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-50 font-sans text-gray-800">

  <!-- Sidebar -->
  <aside class="fixed top-0 left-0 h-screen w-64 bg-white shadow-md flex flex-col justify-between">
    <div>
      <div class="flex items-center justify-center h-16 border-b">
        <h1 class="text-xl font-bold text-blue-600">Vendora</h1>
      </div>
      <nav class="mt-6 space-y-1">
        <a href="/user/dashboard" class="flex items-center gap-3 py-3 px-6 hover:bg-blue-50">üè† Dashboard</a>
        <a href="/shop" class="flex items-center gap-3 py-3 px-6 hover:bg-blue-50">üõçÔ∏è Shop</a>
        <a href="/shop/cart" class="flex items-center gap-3 py-3 px-6 hover:bg-blue-50">üõí Cart</a>
        <a href="/user/orders"
          class="flex items-center gap-3 py-3 px-6 bg-blue-100 text-blue-700 font-medium rounded-r-full">üì¶ Orders</a>
        <a href="/shop/wishlist" class="flex items-center gap-3 py-3 px-6 hover:bg-blue-50">‚ù§Ô∏è Wishlist</a>
        <a href="/user/settings" class="flex items-center gap-3 py-3 px-6 hover:bg-blue-50">‚öôÔ∏è Settings</a>
      </nav>
    </div>

    <div class="p-6 border-t">
      <a href="/logout"
        class="block text-center cursor-pointer bg-red-50 text-red-600 px-4 py-2 rounded-lg hover:bg-red-100 text-sm font-medium">
        Logout
      </a>
    </div>
  </aside>

  <!-- Main -->
  <main class="ml-64 min-h-screen">
    <header class="bg-white shadow-sm px-8 py-4 flex justify-between items-center sticky top-0 z-10">
      <h2 class="text-lg font-semibold text-gray-700">üí≥ Checkout</h2>
      <div class="flex items-center space-x-4">
        <span class="text-gray-700 text-sm">Hello, <span class="font-medium text-blue-600"
            th:text="${user.name}">User</span></span>
        <img th:src="${user.profileImage != null ? user.profileImage : '/images/default-avatar.png'}" alt="Avatar"
          class="w-10 h-10 rounded-full border object-cover">
      </div>
    </header>

    <section class="p-10">
      <div class="bg-white shadow-lg rounded-2xl p-8">

        <div th:if="${#lists.isEmpty(products)}" class="text-center text-gray-500 italic">
          Your cart is empty. <a th:href="@{/shop}" class="text-blue-600 hover:underline">Go Shopping</a>
        </div>

        <div th:unless="${#lists.isEmpty(products)}">
          <table class="w-full mb-6">
            <thead>
              <tr class="border-b">
                <th class="text-left py-2">Product</th>
                <th class="text-left py-2">Price</th>
                <th class="text-left py-2">Qty</th>
                <th class="text-left py-2">Subtotal</th>
              </tr>
            </thead>
            <tbody>
              <tr th:each="product : ${products}" class="border-b">
                <td th:text="${product.name}" class="py-2"></td>
                <td>‚Çπ<span th:text="${product.price}"></span></td>
                <td th:text="${cartItems[product.id]}" class="py-2"></td>
                <td>‚Çπ<span
                    th:text="${product.price.multiply(T(java.math.BigDecimal).valueOf(cartItems[product.id]))}"></span>
                </td>
              </tr>
            </tbody>
          </table>

          <div class="flex justify-between items-center mt-6">
            <h3 class="text-lg font-semibold">Total: ‚Çπ<span th:text="${total}"></span></h3>

            <form th:action="@{/shop/checkout/confirm}" method="post">
              <input type="hidden" th:if="${_csrf != null}" th:name="${_csrf.parameterName}"
                th:value="${_csrf.token}" />
              <button type="submit"
                class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 text-sm font-medium shadow-md transition">
                ‚úÖ Confirm Purchase
              </button>
            </form>
          </div>
        </div>

      </div>
    </section>
  </main>
</body>
</html>
